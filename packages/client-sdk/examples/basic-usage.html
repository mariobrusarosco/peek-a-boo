<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Peek-a-boo SDK Basic Example</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    .feature {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    button {
      background-color: #4a5568;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background-color: #2d3748;
    }
    .hidden {
      display: none;
    }
    code {
      display: block;
      background-color: #f7fafc;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      white-space: pre-wrap;
      font-family: monospace;
    }
    #flag-status {
      margin-top: 20px;
      padding: 15px;
      background-color: #f0fff4;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>Peek-a-boo SDK Basic Example</h1>
  
  <div class="feature">
    <h2>Feature Flag Status</h2>
    <p>This example shows how to use the Peek-a-boo client SDK to check feature flags.</p>
    
    <div id="flag-status">
      <p>Loading feature flags...</p>
    </div>
    
    <div class="actions">
      <button id="refresh-flags">Refresh Flags</button>
      <button id="toggle-user">Switch User</button>
    </div>
  </div>
  
  <div class="feature">
    <h2>Feature: New UI</h2>
    <div id="new-ui" class="hidden">
      <p>ðŸŽ‰ You're seeing the new UI design!</p>
      <div style="height: 50px; background: linear-gradient(to right, #4a5568, #2d3748); border-radius: 8px;"></div>
    </div>
    <div id="old-ui">
      <p>You're seeing the classic UI design.</p>
      <div style="height: 50px; background-color: #e2e8f0; border-radius: 8px;"></div>
    </div>
  </div>
  
  <div class="feature">
    <h2>Feature: Theme Color</h2>
    <p>Current theme: <span id="theme-value">default</span></p>
    <button id="theme-button">Click me</button>
  </div>
  
  <div class="feature">
    <h2>SDK Integration Code</h2>
    <code>
// Initialize the client
const client = new PeekABoo.FeatureFlagClient({
  apiKey: 'demo-api-key',
  environmentKey: 'development',
  
  // For demo purposes, we're using mock data instead of a real API
  baseUrl: 'mock',
  pollingInterval: 0,
  
  // Bootstrap with initial flags
  bootstrap: {
    'new-ui': false,
    'theme-color': 'blue',
    'premium-feature': false
  }
});

// Check if a feature flag is enabled
const isEnabled = client.isEnabled('new-ui', {
  context: { userId: 'user-123' }
});
    </code>
  </div>

  <!-- Load the UMD bundle -->
  <script src="../dist/index.umd.js"></script>
  
  <script>
    // Mock implementation for demo purposes
    const mockFlags = {
      'user-123': {
        'new-ui': true,
        'theme-color': 'purple',
        'premium-feature': false
      },
      'user-456': {
        'new-ui': false,
        'theme-color': 'green',
        'premium-feature': true
      }
    };
    
    // Override fetch implementation for the demo
    const originalFetch = window.fetch;
    window.fetch = function(url, options) {
      if (url.includes('mock')) {
        return new Promise((resolve) => {
          // Simulate network delay
          setTimeout(() => {
            const currentUser = localStorage.getItem('currentUser') || 'user-123';
            resolve({
              ok: true,
              json: () => Promise.resolve({ 
                flags: mockFlags[currentUser] || mockFlags['user-123']
              })
            });
          }, 500);
        });
      }
      return originalFetch(url, options);
    };
    
    // Initialize the client
    let currentUser = localStorage.getItem('currentUser') || 'user-123';
    const client = new PeekABoo.FeatureFlagClient({
      apiKey: 'demo-api-key',
      environmentKey: 'development',
      baseUrl: 'mock',
      pollingInterval: 0,
      bootstrap: mockFlags[currentUser] || mockFlags['user-123']
    });
    
    // Update UI based on flags
    function updateUI() {
      const flagStatusEl = document.getElementById('flag-status');
      const newUiEl = document.getElementById('new-ui');
      const oldUiEl = document.getElementById('old-ui');
      const themeValueEl = document.getElementById('theme-value');
      const themeButtonEl = document.getElementById('theme-button');
      
      // Get current user
      currentUser = localStorage.getItem('currentUser') || 'user-123';
      const context = { userId: currentUser };
      
      // Check feature flags
      const newUiEnabled = client.isEnabled('new-ui', { context });
      const themeColor = client.getValue('theme-color', { 
        context, 
        defaultValue: 'default' 
      });
      
      // Update UI elements
      if (newUiEnabled) {
        newUiEl.classList.remove('hidden');
        oldUiEl.classList.add('hidden');
      } else {
        newUiEl.classList.add('hidden');
        oldUiEl.classList.remove('hidden');
      }
      
      themeValueEl.textContent = themeColor;
      themeButtonEl.style.backgroundColor = themeColor;
      
      // Update flag status display
      const currentFlags = {
        'new-ui': newUiEnabled,
        'theme-color': themeColor,
        'user': currentUser
      };
      
      flagStatusEl.innerHTML = `
        <h3>Current Flags</h3>
        <pre>${JSON.stringify(currentFlags, null, 2)}</pre>
      `;
    }
    
    // Set up event listeners
    document.getElementById('refresh-flags').addEventListener('click', async () => {
      await client.fetchFlags();
      updateUI();
    });
    
    document.getElementById('toggle-user').addEventListener('click', () => {
      const newUser = localStorage.getItem('currentUser') === 'user-456' ? 'user-123' : 'user-456';
      localStorage.setItem('currentUser', newUser);
      client.fetchFlags();
      updateUI();
    });
    
    // Subscribe to flag changes
    client.onFlagsChanged(() => {
      updateUI();
    });
    
    // Initial UI update
    updateUI();
  </script>
</body>
</html> 